generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ====================================
// ENUMS
// ====================================

enum Role {
  ADMIN
  WARDEN
  STUDENT
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ComplaintStatus {
  PENDING
  IN_PROGRESS
  RESOLVED
}

enum ItemStatus {
  AVAILABLE
  SOLD
}

enum LostFoundType {
  LOST
  FOUND
}

// ====================================
// USER MODEL
// ====================================

model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  role      Role      @default(STUDENT)
  roomNumber String?
  createdAt DateTime  @default(now())

  // Relations
  leaves        Leave[]
  complaints    Complaint[]
  marketplace   MarketplaceItem[]
  feedback      MessFeedback[]
  votes         PollVote[]
  lostfound     LostFound[]
  notifications Notification[]
  notificationReads NotificationRead[]
}

// ====================================
// LEAVE MANAGEMENT
// ====================================

model Leave {
  id        Int         @id @default(autoincrement())
  userId    Int
  fromDate  DateTime
  toDate    DateTime
  reason    String
  status    LeaveStatus @default(PENDING)
  createdAt DateTime    @default(now())

  user      User        @relation(fields: [userId], references: [id])
}


// ====================================
// COMPLAINT MODULE (NO PHOTOS)
// ====================================

model Complaint {
  id          Int             @id @default(autoincrement())
  userId      Int
  title       String
  description String
  status      ComplaintStatus @default(PENDING)
  createdAt   DateTime        @default(now())

  user        User            @relation(fields: [userId], references: [id])
}

// ====================================
// MESS MENU + FEEDBACK
// ====================================

model MessMenu {
  id        Int      @id @default(autoincrement())
  day       String   // "Monday", etc.
  breakfast String
  lunch     String
  dinner    String
  createdAt DateTime @default(now())

  feedbacks MessFeedback[]
}

model MessFeedback {
  id        Int      @id @default(autoincrement())
  userId    Int
  menuId    Int
  rating    Int      // 1 or -1
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id])
  menu      MessMenu @relation(fields: [menuId], references: [id])
}

// ====================================
// MARKETPLACE (NO IMAGES)
// ====================================

model MarketplaceItem {
  id          Int         @id @default(autoincrement())
  userId      Int
  title       String
  description String
  price       Float
  status      ItemStatus  @default(AVAILABLE)
  createdAt   DateTime    @default(now())

  user        User        @relation(fields: [userId], references: [id])
}

// ====================================
// POLLS AND VOTES
// ====================================

model Poll {
  id        Int       @id @default(autoincrement())
  question  String
  options   Json      // ["Option A","Option B"]
  createdBy Int
  createdAt DateTime  @default(now())

  votes     PollVote[]
}

model PollVote {
  id        Int      @id @default(autoincrement())
  pollId    Int
  userId    Int
  option    String
  createdAt DateTime @default(now())

  poll      Poll     @relation(fields: [pollId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
}

// ====================================
// LOST & FOUND (NO IMAGES)
// ====================================

model LostFound {
  id          Int            @id @default(autoincrement())
  userId      Int
  type        LostFoundType
  title       String
  description String
  location    String
  resolved    Boolean        @default(false)
  createdAt   DateTime       @default(now())

  user        User           @relation(fields: [userId], references: [id])
}

// ====================================
// NOTIFICATIONS
// ====================================

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int?
  targetRole Role?
  title     String
  message   String
  read      Boolean   @default(false) // Only used for individual notices
  createdAt DateTime  @default(now())

  user      User?     @relation(fields: [userId], references: [id])
  reads     NotificationRead[]
}

model NotificationRead {
  id             Int          @id @default(autoincrement())
  userId         Int
  notificationId Int
  createdAt      DateTime     @default(now())

  user           User         @relation(fields: [userId], references: [id])
  notification   Notification @relation(fields: [notificationId], references: [id])

  @@unique([userId, notificationId])
}
